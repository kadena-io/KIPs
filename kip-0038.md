---
KIP: '0038'
Title: kadena_getAccounts_v2 API
Author: Danillo Felixdaal and Bart Huijgen
Status: Draft
Type: Standard
Category: Interface
Created: 2025-02-17
---

# kadena_getAccounts_v2 API

## Abstract

This KIP standardizes the `kadena_getAccounts_v2` method, which enables wallets to provide a standardized list of accounts they manage. By implementing this method, decentralized applications (dApps) can retrieve and present to users the available accounts, allowing users to select the desired account for creating and signing transactions.

## Motivation

The `kadena_getAccounts_v2` method allows retrieval of all accounts managed by a wallet along with per fungible and per-chain guard information.

---

## Specification

### Method Definition

**Method Name:** `kadena_getAccounts_v2`

### Request Parameters

```typescript
interface GetAccountsRequest {
  publicKey?: string
  contract?: string
}
```

> **Note:** If both `publicKey` and `contract` are omitted, the implementation **MAY** default to returning all accounts managed by the wallet.

### Response

The method **MUST** return an array of account objects. Even if the wallet only supports a single account, the response **MUST** be an array containing that single account.

```typescript
interface AccountInfo {
  accountName: string
  fungibleContract: string
  chainAccounts?: Array<{
    chainId: string
    guard: {
      keys: string[]
      pred: string
    }
  }>
}
```

### Error Responses

In case of failure, the wallet **MUST** return an error object that conforms to the [JSON-RPC 2.0 specification](https://www.jsonrpc.org/specification#error_object). The error object includes an error code, a message, and optionally additional data.

```typescript
interface ErrorResponse {
  id: number
  jsonrpc: '2.0'
  error: {
    code: number
    message: string
    data?: object
  }
}
```

#### Error Types

| Code   | Message                          |
| ------ | -------------------------------- |
| -32603 | Internal server error            |
| -32008 | No account information available |

### Behavior Requirements

1. **Account Information Retrieval:**

   - **MUST** return accurate and up-to-date information for all accounts managed by the wallet.
   - If filtering parameters (`publicKey` and/or `contract`) are provided, the method **MUST** return only the matching accounts.
   - If a wallet supports only a single active account, the method **MUST** return an array containing that single account.
   - The returned account information **MUST** include all relevant details as defined in the response interface.

2. **Error Handling:**
   - **MUST** return a clear and descriptive error message if account information cannot be retrieved.
   - Errors may result from configuration issues, unsupported networks, or other internal errors.
   - The error response **MUST** conform to the JSON-RPC 2.0 error object specification.

## Examples

### Example Request Without Parameters

In this example, no parameters are provided so that all accounts managed by the wallet are returned:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "kadena_getAccounts_v2"
}
```

### Example Request by Public Key

In this example, filtering by public key and contract is requested:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "kadena_getAccounts_v2",
  "params": {
    "publicKey": "60870392901728fe6bb773534d71272d0851b587cb91cb859a303b20f1025069",
    "contract": "coin"
  }
}
```

### Example Response (Multiple Accounts)

This example demonstrates two accounts from the same underlying wallet: one for the `coin` contract and another for the `kdx` contract.

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "result": [
    {
      "accountName": "k:35d381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f7",
      "fungibleContract": "coin",
      "chainAccounts": [
        {
          "chainId": "0",
          "guard": {
            "keys": [
              "35d381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f7"
            ],
            "pred": "keys-all"
          }
        }
      ]
    },
    {
      "accountName": "k:2a6f381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f8",
      "fungibleContract": "kdx",
      "chainAccounts": [
        {
          "chainId": "0",
          "guard": {
            "keys": [
              "2a6f381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f8"
            ],
            "pred": "keys-all"
          }
        }
      ]
    }
  ]
}
```

### Example Response (Single Account)

Even if only one account is supported, the response **MUST** be an array with one element:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "result": [
    {
      "accountName": "k:35d381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f7",
      "fungibleContract": "coin",
      "chainAccounts": [
        {
          "chainId": "0",
          "guard": {
            "keys": [
              "35d381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f7"
            ],
            "pred": "keys-all"
          }
        }
      ]
    }
  ]
}
```

### Error Response Examples

#### Internal Server Error

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "error": {
    "code": -32603,
    "message": "Internal server error"
  }
}
```

#### Account Not Found / No Account Information Available

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "error": {
    "code": -32008,
    "message": "Account not found for the provided publicKey and contract"
  }
}
```

Or, in cases where no account information is available:

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "error": {
    "code": -32008,
    "message": "No account information available"
  }
}
```

## Backwards Compatibility

- **Legacy Methods:** Wallets **MAY** support older methods for retrieving account information alongside `kadena_getAccounts_v2`. Legacy methods **MUST** be documented as deprecated and phased out over time.

- **Configuration Consistency:** Implementations **MUST** ensure that the returned account information matches the walletâ€™s stored configuration.

## Security Considerations

- **Data Accuracy:** Ensure that the returned account information is accurate and verified.
- **Error Handling:** Clear error messages must be provided to avoid misinterpretation and to assist developers in debugging issues related to account retrieval.
