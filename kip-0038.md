---
KIP: '0038'
Title: kadena_getAccounts_v2 API
Author: Danillo Felixdaal and Bart Huijgen
Status: Draft
Type: Standard
Category: Interface
Created: 2025-02-17
---

# kadena_getAccounts_v2 API

## Abstract

This proposal introduces the `kadena_getAccounts_v2` method, which enables wallets to provide a standardized list of accounts they manage. By implementing this method, decentralized applications (dApps) can retrieve and present to users the available accounts, allowing users to select the desired account for creating and signing transactions.

## Motivation

The `kadena_getAccounts_v2` method improved on the previous by allowing extra features while maintaining backwards compatibility. This method allows to retrieve all accounts managed by a wallet as well as receive per fungible and per chain guard information. This is required for accounts that allow rotating keysets and vanity name accounts.

## Specification

### Method Definition

**Method Name:** `kadena_getAccounts_v2`

### Request Parameters

```typescript
interface GetAccountsRequest {
  accounts?: Array<{
    publicKey: string;
    contract: string;
  }
}
```

### Response

```typescript
interface AccountInfo {
  accountName: string
  fungibleContract: string
  chainAccounts?: Array<{
    chainId: ChainId
    guard: {
      keys: string[]
      pred: string
    }
  }>
}
```

### Error Responses

In case of failure, the wallet MUST return an error object that conforms to the [jsonrpc spec](https://www.jsonrpc.org/specification#error_object) The error object includes an error code, a message, and optionally additional data.

```typescript
interface ErrorResponse {
  id: number
  jsonrpc: '2.0'
  error: {
    code: number
    message: string
    data?: object
  }
}
```

### Error types

| Code   | Message               |
| ------ | --------------------- |
| -32603 | Internal server error |

### Behavior Requirements

1. Account Information Retrieval:

- MUST return accurate and up-to-date information about all known accounts managed by the wallet.
- If the wallet supports only a single active account, it MUST return information for that account.
- The account information MUST include all relevant details as specified in the response interface.

2. Event Emission:

- SHOULD emit a kadena_accountChanged event whenever there is a change in the active account or the list of known accounts.
- Emitting this event helps dApps stay synchronized with the wallet's state, ensuring users interact with the correct account.

3. Error Handling:

- MUST return a clear and descriptive error message if account information cannot be retrieved.
- Errors may be due to configuration issues, unsupported networks, or other internal errors.
- The error response MUST conform to the JSON-RPC error object specification.

# Examples

### Example request

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "kadena_getAccounts_v2",
  "params": {}
}
```

### Example response

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "result": [
    {
      "accountName": "k:35d381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f7",
      "fungibleContract": "coin",
      "chainAccounts": [
        {
          "chainId": "0",
          "guard": {
            "keys": [
              "35d381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f7"
            ],
            "pred": "keys-all"
          }
        },
        {
          "chainId": "1",
          "guard": {
            "keys": [
              "35d381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f7"
            ],
            "pred": "keys-all"
          }
        }
      ]
    }
  ]
}
```

### Error Response

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "error": {
    "code": -32603,
    "message": "Internal server error"
  }
}
```

### Response details

Accounts should be returned per fungible contract, if the wallet knows about multiple fungibles held by one account then return the account for each one.

If a wallet only works with single accounts, this method should return a single account.

### Request by public key

kip-0017 defines `kadena_getAccounts_v1`, which uses a public key received from walletconnect to retrieve accounts. The v2 method maintains compatibility with this approach.

## Example request by public key

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "kadena_getAccounts_v2",
  "params": {
    "accounts": [
      {
        "publicKey": "60870392901728fe6bb773534d71272d0851b587cb91cb859a303b20f1025069",
        "contract": "coin"
      }
    ]
  }
}
```

## Example response by public key

```json
{
  "id": 1,
  "jsonrpc": "2.0",
  "result": [
    {
      "accountName": "w:Gkx0oHalSq0TpNQjx7Q4UTgZteaQ1QwnBH3hR60VCuY:keys-all",
      "fungibleContract": "coin",
      "chainAccounts": [
        {
          "chainId": "0",
          "guard": {
            "keys": [
              "60870392901728fe6bb773534d71272d0851b587cb91cb859a303b20f1025069",
              "49a7943c8a29962d81142067da4f4fa98940fee89efc4780b86adef9546b493a"
            ],
            "pred": "keys-all"
          }
        }
      ]
    }
  ]
}
```

## Backwards Compatibility

- Legacy Methods: Wallets MAY support older methods for retrieving account information alongside kadena_getAccounts_v1. Legacy methods MUST be documented as deprecated and phased out over time.
- Configuration Consistency: Implementations MUST ensure that the returned account information matches the wallet's active configuration.

## Security Considerations

- Data Accuracy: Ensure that the returned account information is accurate and verified.
- Event Notification: Emit account change events to keep dApps updated and prevent configuration mismatches.
