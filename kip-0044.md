---
KIP: '0044'
Title: kadena_accountChanged_v1 Event
Author: Danillo Felixdaal and Bart Huijgen
Status: Draft
Type: Standard
Category: Interface
Created: 2025-02-17
---

# kadena_accountChanged_v1 Event

## Abstract

This proposal standardizes the **`kadena_accountChanged_v1`** notification event, which wallets **SHOULD** emit whenever the active account changes. By listening to this event, dApps can immediately update the UI and state to match the newly selected account.

## Motivation

A user might switch their active account in the wallet UI, or a wallet might automatically rotate keys. In these situations, the dApp needs to be informed that the active account is no longer valid. Without a standard, consistent event, integrations become ad-hoc and error-prone.

The **`kadena_accountChanged_v1`** event addresses this by:

- Providing a well-defined JSON-RPC event signature.
- Ensuring consistent data is sent for the newly active account.
- Minimizing integration surprises and stale state in dApps.

## Specification

### Event Name

**Method Name:** `kadena_accountChanged_v1`

**Type:** JSON-RPC 2.0 **notification**

> **Important:** As a **notification**, there is typically no `id` field and no response from the dApp is expected.
>
> However, some wallets may choose to send it as a request. In that scenario, the dApp **SHOULD** respond with `null` or an empty result to acknowledge receipt. This nuance does not change the shape of `params`.

### Event Parameters

```typescript
interface AccountChangedEventParams {
  account: {
    accountName: string // e.g., k:<publicKey> or a vanity name
    fungibleContract: string // e.g., coin, or another fungible contract
    chainAccounts?: Array<{
      chainId: string // e.g., "0", "1", ...
      guard: {
        keys: string[] // array of public keys
        pred: string // predicate (e.g., "keys-all")
      }
    }>
  }
}
```

A wallet **MAY** omit optional fields if it does not track them.

### Notification Example

#### Notification

```json
{
  "jsonrpc": "2.0",
  "method": "kadena_accountChanged_v1",
  "params": {
    "account": {
      "accountName": "k:35d381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f7",
      "fungibleContract": "coin",
      "chainAccounts": [
        {
          "chainId": "0",
          "guard": {
            "keys": [
              "35d381861d9a6cfb84bef47930b386d1a3b4f3742c8e87772a9e6b43c0e7b5f7"
            ],
            "pred": "keys-all"
          }
        }
      ]
    }
  }
}
```

> **Note:** As this is a notification, there is no corresponding `"result"` field. Some wallets may include `"id"` out of convention, but dApps MUST treat this method as a fire-and-forget event.

### Behavior Requirements

1. **Emission Triggers**

   - **MUST** emit `kadena_accountChanged_v1` whenever the user actively switches accounts in the wallet.
   - **MUST** emit whenever the wallet rotates keys or otherwise modifies the active account behind the scenes.

2. **Payload Accuracy**

   - **MUST** accurately reflect the updated active account at emission time.
   - **SHOULD** include any chain-specific guard details if the wallet is aware of them.

3. **Error Handling**

   - **N/A** for notifications. The wallet does not expect any direct acknowledgment or error code from the dApp.

4. **Backwards Compatibility**
   - Wallets using earlier methods (e.g., custom event names) **SHOULD** continue to support them for a transition period.
   - Documentation **MUST** mark older event names as deprecated once `kadena_accountChanged_v1` is implemented.

## Security Considerations

- **Untrusted Source**: dApps **SHOULD** treat wallet events as untrusted input but can trust that the wallet holds correct account state.
- **Session Updates**: dApps **MUST** handle multiple or repeated notifications gracefully, ensuring they do not erroneously rely on stale account data.
